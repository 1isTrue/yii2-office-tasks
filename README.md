# Тестовое задание: Система заявок на обслуживание
Сервис для учёта заявок на обслуживание в офисе

[Yii2 Original docs](https://github.com/yiisoft/yii2-app-basic/blob/db7f9237660c9bec41f04f4fa34221bf7a5d778d/README.md)

# Security warning!
В данном репозитории размещен файл `.env.example` содержащий ключи в открытом виде! Это сделано исключительно в целях упрощения доставки секретов.

# Развёртывание
```shell
mv ./.env.example ./.env

```

## local
```shell
composer install
php yii migrate
php yii serve
```

## docker
```shell
docker-compose run --rm php composer install
docker-compose up -d
```

# TODO:
- [x] Добавление базы данных в docker-compose
- [x] Перенос конфигурации в env
  - [ ] Безопасный способ доставки секретов
- [x] Созданние миграций и моделей
- [x] Страница отображения списка задач
- [ ] CSRF
  - [ ] Постраничный вывод задач / дозагрузка / recyclerView
- [x] Страница создания задачи
- [x] Страница просмотра задачи
- [x] Добавление комментариев
  - [ ] Постраничный вывод комментариев / дозагрузка / recyclerView
- [ ] Загрузка изображений, возврат id загрузок
- [ ] Удаление изображений + csrf
- [ ] Разделение адресов api и userview
- [ ] Документация API
- [ ] Более точные и развёрнутые сообщения об ошибках
- [ ] Валидация загруженных файлов не только по расширению, но и содержимому, соотношению сторон
- [ ] Отдельный инстанс для загрузки изображений
- [ ] Асинхронные задачи загрузки сообщений + брокер
- [ ] Longpoll для получения статуса загрузки изображения

# Questions
- Задачи удаляютя из базы физически или deleted=1?
- Foreignkeys в базе данных актуальны? Подразумеваем каскадное удаление комментариев и фотографий при удалении задачи?
- Размер загружаемого изображений 2MB (2 000 000 bytes), возможно имелось в виду 2MiB (2 097 152 bytes)? 
- Уточнение по задаче загрузки изображений, на какой странице осуществляется загрузка изображений?
- Требования отображения превью изображения ПОСЛЕ загрузки, допускает отображение превью и ПЕРЕД загрузкой?
- Делаем upload изображений сразу при выборе или только при создании задачи?
- Допустима ли загрузка изображений с нарушенными пропорциями? 1x1000px
- Есть ограничения на размеры (в пикселях) изображений (минимум/максимум)
- Нужна ли генерация отдельных файлов превью на сервере? Делать это на лету при запросе или создавать файлы превью при загрузке оригинальных файлов (один размер превью или несколько?) сохраняем пропорции при генерации превью?
- Нужна ли возможность просмотра фотографии/фотографий или выводить их в на странице просмотра задачи сразу в полном размере
- Удаление загруженных изображений из задачи подразумевает замену их на изображения загруженные ранее (просто выводим 5 послених или храним только 5 последних)?
- Есть ограничения размеров заголовков и описаний задач (TEXT/LONGTEXT) и список допустимых символов (допустимы emoji?), валидируем utf8? в случае длинных заголовков нужно их сокращать при отображении в таблице? Допустимы неразрывные длинные последовательности символов (используем word-wrap)?
- При наличии переносов строк в комментариях сохраняем исходное форматирование? Сохраняем отступы?
- Нужно ли выносить js в отдельные файлы для кеширования и уменьшения размера страниц?
- Загрузка изображений перетаскиванием в окно браузера?
- Храним оригинальные файлы изображений или уменьшаем размер/убираем мета информацию? Приводим файлы изображений к общему формату? png допускаем прозрачность?
- Поведение при невозможности загрузки изображений, повторяем попытку/выводим сообщение об ошибке?
- Валидация на клиенте (вводимых данных? изображений?) Изображений по каким-то ещё критериям кроме расширения и размера файла?